{% extends 'main/template.html' %}
{% load static %}

{% block head %}
<link rel="stylesheet" href="{% static 'main/create-user-profile.css' %}">
{% endblock %}

{% block title %}
    Create user profile
{% endblock %}

{% block content %}
<h1>
    <a href="{% url 'registration:registration' %}">Registration </a>
    <b> ⮞ </b>
    <a href="{% url 'registration:login' %}">Login</a><b> ⮞ </b>
    Profile
</h1>
<form method="post" enctype="multipart/form-data">
    <div class="profile-container">
        {% csrf_token %}
        <div class="avatar-block">
            <img id="avatarPreview"
                src="{% if userprofile_form.avatar.value %}
                     {{ userprofile_form.avatar.value.url}} {% else %} {% static 'main/default-avatar.png' %} {% endif %}"
                alt="avatar">

            <!-- custom button -->
            <input type="button" id="uploadBtn" value="ChooseAvatar">
            <span id="fileName">No file chosen</span>

            <!-- hidden input -->
            {{ userprofile_form.avatar }}
        </div>
        <div class="name-block">
            {{ userprofilename_form.first_name.label_tag|cut:":"  }}   
            {{ userprofilename_form.first_name }}
            {{ userprofilename_form.last_name.label_tag|cut:":" }}
            {{ userprofilename_form.last_name }}
            <div class="info-block">
                {{userprofile_form.age.label_tag|cut:":"}}
                {{userprofile_form.age}}
                {{userprofile_form.gender.label_tag|cut:":"}}
                {{userprofile_form.gender}}
            </div>
        </div>
        <div class="interests-block">
            {{userprofile_form.interests.label_tag|cut:":"}}
            <div class="checkbox-scroll">
                {% for checkbox in userprofile_form.interests %}
                    <div class="checkbox-item">
                        {{ checkbox.tag }} {{ checkbox.choice_label }}
                    </div>
                {% endfor %}
            </div>
        </div>
        <input class="submit-form" type="submit" value="✔">
    </div>    
</form>
<script src="{% static 'django_select2/django_select2.js' %}"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    const input = document.querySelector("#id_avatar");
    const preview = document.querySelector("#avatarPreview");
    const uploadBtn = document.querySelector("#uploadBtn");
    const fileName = document.querySelector("#fileName");

    // click button → open file dialog
    uploadBtn.addEventListener("click", () => input.click());

    // show filename + preview
    input.addEventListener("change", () => {
        const file = input.files[0];
        if (file) {
            fileName.textContent = file.name; // show file name
            const reader = new FileReader();
            reader.onload = e => preview.src = e.target.result;
            reader.readAsDataURL(file);
        } else {
            fileName.textContent = "No file chosen";
        }
    });
});
</script>
{% endblock %}
